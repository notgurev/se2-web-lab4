<!--suppress HtmlFormInputWithoutLabel -->
<p-toast position="top-left" key="main"></p-toast>
<div>
  <p-toolbar>
    <div class="p-toolbar-group-left">
      Mode: {{ dms.mode }}
    </div>
    <div class="p-toolbar-group-right">
      <span style="margin-right: 0.5rem">{{ username }}</span>
      <p-button (click)="signOut()">Sign out</p-button>
      <p-button routerLink="/auth" [ngStyle]="{'margin-left':'0.5rem'}">Go to auth page</p-button>
    </div>
  </p-toolbar>
  <div class="container">

    <!-- Canvas -->
    <p-panel id="canvas-panel" header="Canvas">
      <app-canvas [radius]="canvasRadius" [widthHeight]="500" [data]="hits" [matching-radius]="matchingRadius"
                  (onSubmit)="submitHit($event)"
      ></app-canvas>
      <!-- Canvas settings -->
      <div style="max-width: 500px">
        <div class="p-field-checkbox">
          <p-checkbox [(ngModel)]="matchingRadius" [binary]="true" id="matching-radius"></p-checkbox>
          <label for="matching-radius">Matching radius</label>
        </div>
        <div>
          <p>R = {{canvasRadius}}</p>
          <p-slider [(ngModel)]="canvasRadius" [step]="1" [min]="0" [max]="3"></p-slider>
        </div>
      </div>
    </p-panel>

    <!-- Manual input -->
    <p-panel id="manual-input-panel" header="Manual input">
      <form [formGroup]="pointForm" style="text-align: center">

        <div class="p-field">
          <div class="p-inputgroup" style="align-items: center">
            <p style="margin-right: 10px">X:</p>
            <p-listbox [options]="xValues" formControlName="x" [listStyle]="{'max-height':'100px'}"></p-listbox>
          </div>
        </div>

        <!-- Y -->
        <div class="p-field">
          <!-- Y input field -->
          <div class="p-inputgroup">
            <p style="margin-right: 10px">Y:</p>
            <input [class.p-invalid]="yForm.invalid && yForm.touched" pInputText formControlName="y">
          </div>
          <!-- Y validation messages -->
          <div *ngIf="yForm.invalid && yForm.touched" class="p-invalid">
            <small *ngIf="yForm.errors?.required">
              Y is required
            </small>
            <small *ngIf="yForm.errors?.min || yForm.errors?.max">
              Y must be in range (-5...5)
            </small>
            <small *ngIf="(yForm.value && !+(yForm.value)) || yForm.errors?.pattern">
              Y must be a number
            </small>
          </div>
        </div>

        <!-- R -->
        <div class="p-field">
          <div class="p-inputgroup" style="align-items: center">
            <p style="margin-right: 10px">R:</p>
            <!-- R input ListBox -->
            <p-listbox [options]="rValues" formControlName="r" [listStyle]="{'max-height':'100px'}"></p-listbox>
            <!-- R validation messages -->
            <small *ngIf="rForm.value < 0" class="p-invalid" style="margin-left: 0.5rem">
              Radius must be positive.
            </small>
          </div>
        </div>

        <div id="manual-input-buttons">
          <p-button id="submit" (click)="submitHit(pointForm.value)"
                    [disabled]="pointForm.invalid || !+(yForm.value)">Submit</p-button>
          <p-button id="clear" (click)="clearHits()" [ngStyle]="{'margin-left':'0.5rem'}">Clear hits</p-button>
        </div>

      </form>
    </p-panel>

    <!-- Table -->
    <p-panel id="table-panel" header="Table">
      <p-table id="hits-table" [value]="hits">
        <ng-template pTemplate="header">
          <tr>
            <th>X</th>
            <th>Y</th>
            <th>R</th>
            <th>Result</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-hit>
          <tr>
            <td>{{hit.x}}</td>
            <td>{{hit.y | number: '1.2'}}</td>
            <td>{{hit.r}}</td>
            <td>{{hit.result ? 'Hit' : 'Miss'}}</td>
          </tr>
        </ng-template>
      </p-table>
    </p-panel>

  </div>
</div>
